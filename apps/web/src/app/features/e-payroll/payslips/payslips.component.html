<div class="relative flex size-full min-h-screen flex-col bg-slate-50 group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
  <div class="layout-container flex h-full grow flex-col">
    <div class="flex flex-1 justify-center py-3">
      <div class="layout-content-container flex flex-col max-w-[1200px] flex-1 mx-4">
        <div class="flex flex-wrap justify-between gap-3 p-3">
          <p class="text-[#0d151c] tracking-light text-[28px] font-bold leading-tight min-w-72">Welcome, {{ userName }}</p>
        </div>
        <h2 class="text-[#0d151c] text-[20px] font-bold leading-tight tracking-[-0.015em] px-3 pb-2 pt-3">ðŸ“„ Payslip Details</h2>
        
        <!-- Salary Breakdown Section -->
        <div class="pb-2">
          <div class="flex border-b border-[#cedce8] px-3 gap-6">
            <a 
              class="flex flex-col items-center justify-center border-b-[3px] pb-[10px] pt-3 cursor-pointer transition-all duration-200"
              [class.border-b-[#0b80ee]]="activeTab === 'Salary Breakdown'"
              [class.border-b-transparent]="activeTab !== 'Salary Breakdown'"
              [class.text-[#0d151c]]="activeTab === 'Salary Breakdown'"
              [class.text-[#49749c]]="activeTab !== 'Salary Breakdown'"
              (click)="onTabChange('Salary Breakdown')"
            >
              <p class="text-sm font-bold leading-normal tracking-[0.015em]">Salary Breakdown</p>
            </a>
            <a 
              class="flex flex-col items-center justify-center border-b-[3px] pb-[10px] pt-3 cursor-pointer transition-all duration-200"
              [class.border-b-[#0b80ee]]="activeTab === 'Payslip History'"
              [class.border-b-transparent]="activeTab !== 'Payslip History'"
              [class.text-[#0d151c]]="activeTab === 'Payslip History'"
              [class.text-[#49749c]]="activeTab !== 'Payslip History'"
              (click)="onTabChange('Payslip History')"
            >
              <p class="text-sm font-bold leading-normal tracking-[0.015em]">Payslip History</p>
            </a>
          </div>
        </div>

        <!-- Salary Breakdown Tab -->
        <div *ngIf="activeTab === 'Salary Breakdown'" class="animate-fadeIn">
          <div class="flex gap-2 p-2 flex-wrap pr-3">
            <button class="flex h-7 shrink-0 items-center justify-center gap-x-2 rounded-full bg-[#e7edf4] pl-3 pr-2">
              <p class="text-[#0d151c] text-sm font-medium leading-normal">{{ selectedTimeRange }}</p>
              <div class="text-[#0d151c]" data-icon="CaretDown" data-size="16px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                </svg>
              </div>
            </button>
          </div>
          <div class="flex px-3 py-2">
            <div class="flex h-9 flex-1 items-center justify-center rounded-full bg-[#e7edf4] p-1">
              <label
                class="flex cursor-pointer h-full grow items-center justify-center overflow-hidden rounded-full px-2 has-[:checked]:bg-slate-50 has-[:checked]:shadow-[0_0_4px_rgba(0,0,0,0.1)] has-[:checked]:text-[#0d151c] text-[#49749c] text-sm font-medium leading-normal"
              >
                <span class="truncate">Line Chart</span>
                <input type="radio" name="chartType" class="invisible w-0" value="Line Chart" [checked]="selectedChartType === 'Line Chart'" (change)="onChartTypeChange('Line Chart')" />
              </label>
              <label
                class="flex cursor-pointer h-full grow items-center justify-center overflow-hidden rounded-full px-2 has-[:checked]:bg-slate-50 has-[:checked]:shadow-[0_0_4px_rgba(0,0,0,0.1)] has-[:checked]:text-[#0d151c] text-[#49749c] text-sm font-medium leading-normal"
              >
                <span class="truncate">Bar Chart</span>
                <input type="radio" name="chartType" class="invisible w-0" value="Bar Chart" [checked]="selectedChartType === 'Bar Chart'" (change)="onChartTypeChange('Bar Chart')" />
              </label>
            </div>
          </div>
          <div class="flex flex-wrap gap-3 px-3 py-4">
            <div class="flex min-w-72 flex-1 flex-col gap-2 rounded-xl border border-[#cedce8] p-4">
              <p class="text-[#0d151c] text-base font-medium leading-normal">Salary Trend</p>
              <p class="text-[#0d151c] tracking-light text-[28px] font-bold leading-tight truncate">${{ currentYearSalary.toLocaleString() }}</p>
              <div class="flex gap-1">
                <p class="text-[#49749c] text-base font-normal leading-normal">Yearly</p>
                <p class="text-[#078838] text-base font-medium leading-normal">+{{ salaryGrowth }}%</p>
              </div>
              <div class="flex min-h-[150px] flex-1 flex-col gap-6 py-3">
                <svg width="100%" height="120" viewBox="-3 0 478 150" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
                  <path
                    d="M0 109C18.1538 109 18.1538 21 36.3077 21C54.4615 21 54.4615 41 72.6154 41C90.7692 41 90.7692 93 108.923 93C127.077 93 127.077 33 145.231 33C163.385 33 163.385 101 181.538 101C199.692 101 199.692 61 217.846 61C236 61 236 45 254.154 45C272.308 45 272.308 121 290.462 121C308.615 121 308.615 149 326.769 149C344.923 149 344.923 1 363.077 1C381.231 1 381.231 81 399.385 81C417.538 81 417.538 129 435.692 129C453.846 129 453.846 25 472 25V149H326.769H0V109Z"
                    fill="url(#paint0_linear_1131_5935)"
                  ></path>
                  <path
                    d="M0 109C18.1538 109 18.1538 21 36.3077 21C54.4615 21 54.4615 41 72.6154 41C90.7692 41 90.7692 93 108.923 93C127.077 93 127.077 33 145.231 33C163.385 33 163.385 101 181.538 101C199.692 101 199.692 61 217.846 61C236 61 236 45 254.154 45C272.308 45 272.308 121 290.462 121C308.615 121 308.615 149 326.769 149C344.923 149 344.923 1 363.077 1C381.231 1 381.231 81 399.385 81C417.538 81 417.538 129 435.692 129C453.846 129 453.846 25 472 25"
                    stroke="#49749c"
                    stroke-width="3"
                    stroke-linecap="round"
                  ></path>
                  <defs>
                    <linearGradient id="paint0_linear_1131_5935" x1="236" y1="1" x2="236" y2="149" gradientUnits="userSpaceOnUse">
                      <stop stop-color="#e7edf4"></stop>
                      <stop offset="1" stop-color="#e7edf4" stop-opacity="0"></stop>
                    </linearGradient>
                  </defs>
                </svg>
                <div class="flex justify-around">
                  <p class="text-[#49749c] text-[12px] font-bold leading-normal tracking-[0.015em]">Jan</p>
                  <p class="text-[#49749c] text-[12px] font-bold leading-normal tracking-[0.015em]">Feb</p>
                  <p class="text-[#49749c] text-[12px] font-bold leading-normal tracking-[0.015em]">Mar</p>
                  <p class="text-[#49749c] text-[12px] font-bold leading-normal tracking-[0.015em]">Apr</p>
                  <p class="text-[#49749c] text-[12px] font-bold leading-normal tracking-[0.015em]">May</p>
                  <p class="text-[#49749c] text-[12px] font-bold leading-normal tracking-[0.015em]">Jun</p>
                </div>
              </div>
            </div>
          </div>
          <div class="flex flex-wrap gap-3 px-3 py-4">
            <div class="flex min-w-72 flex-1 flex-col gap-2 rounded-xl border border-[#cedce8] p-4">
              <p class="text-[#0d151c] text-base font-medium leading-normal">Annual Earnings Comparison</p>
              <p class="text-[#0d151c] tracking-light text-[28px] font-bold leading-tight truncate">${{ currentYearSalary.toLocaleString() }}</p>
              <p class="text-[#49749c] text-base font-normal leading-normal">Current Year</p>
              <div class="grid min-h-[150px] grid-flow-col gap-6 grid-rows-[1fr_auto] items-end justify-items-center px-3">
                <div class="border-[#49749c] bg-[#e7edf4] border-t-2 w-full" style="height: 40%;"></div>
                <p class="text-[#49749c] text-[12px] font-bold leading-normal tracking-[0.015em]">Current Year</p>
                <div class="border-[#49749c] bg-[#e7edf4] border-t-2 w-full" style="height: 30%;"></div>
                <p class="text-[#49749c] text-[12px] font-bold leading-normal tracking-[0.015em]">Previous Year</p>
              </div>
            </div>
            <div class="flex min-w-72 flex-1 flex-col gap-2 rounded-xl border border-[#cedce8] p-4">
              <p class="text-[#0d151c] tracking-light text-[28px] font-bold leading-tight truncate">${{ previousYearSalary.toLocaleString() }}</p>
              <p class="text-[#49749c] text-base font-normal leading-normal">Previous Year</p>
            </div>
          </div>
          <div class="p-3 grid grid-cols-[20%_1fr] gap-x-6">
            <div class="col-span-2 grid grid-cols-subgrid border-t border-t-[#cedce8] py-4">
              <p class="text-[#49749c] text-sm font-normal leading-normal">Gross Pay</p>
              <p class="text-[#0d151c] text-sm font-normal leading-normal">${{ grossPay.toLocaleString() }}</p>
            </div>
            <div class="col-span-2 grid grid-cols-subgrid border-t border-t-[#cedce8] py-4">
              <p class="text-[#49749c] text-sm font-normal leading-normal">Deductions</p>
              <p class="text-[#0d151c] text-sm font-normal leading-normal">${{ deductions.toLocaleString() }}</p>
            </div>
            <div class="col-span-2 grid grid-cols-subgrid border-t border-t-[#cedce8] py-4">
              <p class="text-[#49749c] text-sm font-normal leading-normal">Net Pay</p>
              <p class="text-[#0d151c] text-sm font-normal leading-normal">${{ netPay.toLocaleString() }}</p>
            </div>
          </div>
        </div>

        <!-- Unified Payslip History, Detailed Breakdown & Download Tab -->
        <div *ngIf="activeTab === 'Payslip History'" class="animate-fadeIn">
          <div class="p-3">
            <!-- Current Month Summary -->
            <div class="mb-6">
              <h3 class="text-[#0d151c] text-lg font-bold mb-4">Current Month Summary</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div class="rounded-lg border border-[#cedce8] p-4 bg-white">
                  <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 bg-[#e7edf4] rounded-full flex items-center justify-center">
                      <svg class="w-5 h-5 text-[#49749c]" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z"/>
                      </svg>
                    </div>
                    <div>
                      <p class="text-[#0d151c] font-medium">Current Month</p>
                      <p class="text-[#49749c] text-sm">December 2024</p>
                    </div>
                  </div>
                  <div class="space-y-2">
                    <div class="flex justify-between">
                      <span class="text-[#49749c] text-sm">Gross Pay</span>
                      <span class="text-[#0d151c] font-medium">${{ grossPay.toLocaleString() }}</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-[#49749c] text-sm">Net Pay</span>
                      <span class="text-[#0d151c] font-medium">${{ netPay.toLocaleString() }}</span>
                    </div>
                  </div>
                  <div class="mt-3 space-y-2">
                    <button 
                      (click)="downloadAsPDF(null)"
                      class="w-full py-2 bg-[#0b80ee] text-white rounded-lg hover:bg-[#0966c0] transition-colors text-sm font-medium"
                    >
                      Download PDF
                    </button>
                    <button 
                      (click)="viewInBrowser(null)"
                      class="w-full py-2 bg-[#e7edf4] text-[#0d151c] rounded-lg hover:bg-[#d1d9e6] transition-colors text-sm font-medium"
                    >
                      View in Browser
                    </button>
                  </div>
                </div>

                <!-- Detailed Breakdown Card -->
                <div class="rounded-lg border border-[#cedce8] p-4 bg-white">
                  <h4 class="text-[#0d151c] font-semibold mb-3">Earnings</h4>
                  <div class="space-y-2 mb-4">
                    <div class="flex justify-between">
                      <span class="text-[#49749c] text-sm">Basic Salary</span>
                      <span class="text-[#0d151c] font-medium">${{ grossPay.toLocaleString() }}</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-[#49749c] text-sm">Overtime</span>
                      <span class="text-[#0d151c] font-medium">$0</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-[#49749c] text-sm">Bonus</span>
                      <span class="text-[#0d151c] font-medium">$0</span>
                    </div>
                  </div>
                  
                  <h4 class="text-[#0d151c] font-semibold mb-3">Deductions</h4>
                  <div class="space-y-2">
                    <div class="flex justify-between">
                      <span class="text-[#49749c] text-sm">Tax</span>
                      <span class="text-[#0d151c] font-medium">$800</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-[#49749c] text-sm">Insurance</span>
                      <span class="text-[#0d151c] font-medium">$200</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-[#49749c] text-sm">Retirement</span>
                      <span class="text-[#0d151c] font-medium">$200</span>
                    </div>
                  </div>
                </div>

                <!-- Quick Actions Card -->
                <div class="rounded-lg border border-[#cedce8] p-4 bg-white">
                  <h4 class="text-[#0d151c] font-semibold mb-3">Quick Actions</h4>
                  <div class="space-y-2">
                    <button class="w-full py-2 px-3 text-sm bg-[#e7edf4] text-[#0d151c] rounded hover:bg-[#d1d9e6] transition-colors">
                      View All Payslips
                    </button>
                    <button class="w-full py-2 px-3 text-sm bg-[#e7edf4] text-[#0d151c] rounded hover:bg-[#d1d9e6] transition-colors">
                      Export to Excel
                    </button>
                    <button 
                      (click)="printPayslip(null)"
                      class="w-full py-2 px-3 text-sm bg-[#e7edf4] text-[#0d151c] rounded hover:bg-[#d1d9e6] transition-colors"
                    >
                      Print Summary
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Payslip History Table -->
            <div class="mb-6">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-[#0d151c] text-lg font-bold">Payslip History</h3>
                <div class="flex gap-2">
                  <button 
                    (click)="toggleFilters()"
                    class="flex items-center gap-2 px-3 py-2 bg-[#e7edf4] text-[#0d151c] rounded-lg hover:bg-[#d1d9e6] transition-colors text-sm"
                  >
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd"/>
                    </svg>
                    {{ showFilters ? 'Hide' : 'Show' }} Filters
                  </button>
                  <button 
                    (click)="clearFilters()"
                    class="px-3 py-2 bg-[#f8f9fa] text-[#49749c] rounded-lg hover:bg-[#e9ecef] transition-colors text-sm"
                  >
                    Clear All
                  </button>
                </div>
              </div>

              <!-- Filter Panel -->
              <div *ngIf="showFilters" class="mb-6 p-4 bg-[#f8f9fa] rounded-lg border border-[#e7edf4] animate-fadeIn">
                <h4 class="text-[#0d151c] font-semibold mb-3">Filter Payslips</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  <!-- Year Filter -->
                  <div>
                    <label class="block text-[#49749c] text-sm font-medium mb-2">Year</label>
                    <select 
                      [(ngModel)]="filterOptions.year"
                      class="w-full px-3 py-2 border border-[#cedce8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0b80ee] focus:border-transparent"
                    >
                      <option [value]="null">All Years</option>
                      <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
                    </select>
                  </div>

                  <!-- Month Filter -->
                  <div>
                    <label class="block text-[#49749c] text-sm font-medium mb-2">Month</label>
                    <select 
                      [(ngModel)]="filterOptions.month"
                      class="w-full px-3 py-2 border border-[#cedce8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0b80ee] focus:border-transparent"
                    >
                      <option [value]="null">All Months</option>
                      <option *ngFor="let month of availableMonths" [value]="month">{{ month }}</option>
                    </select>
                  </div>

                  <!-- Status Filter -->
                  <div>
                    <label class="block text-[#49749c] text-sm font-medium mb-2">Status</label>
                    <select 
                      [(ngModel)]="filterOptions.status"
                      class="w-full px-3 py-2 border border-[#cedce8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0b80ee] focus:border-transparent"
                    >
                      <option [value]="null">All Status</option>
                      <option *ngFor="let status of availableStatuses" [value]="status">{{ status | titlecase }}</option>
                    </select>
                  </div>

                  <!-- Amount Range -->
                  <div>
                    <label class="block text-[#49749c] text-sm font-medium mb-2">Min Amount</label>
                    <input 
                      type="number" 
                      [(ngModel)]="filterOptions.minAmount"
                      placeholder="Min amount"
                      class="w-full px-3 py-2 border border-[#cedce8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0b80ee] focus:border-transparent"
                    >
                  </div>

                  <div>
                    <label class="block text-[#49749c] text-sm font-medium mb-2">Max Amount</label>
                    <input 
                      type="number" 
                      [(ngModel)]="filterOptions.maxAmount"
                      placeholder="Max amount"
                      class="w-full px-3 py-2 border border-[#cedce8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0b80ee] focus:border-transparent"
                    >
                  </div>

                  <!-- Date Range -->
                  <div>
                    <label class="block text-[#49749c] text-sm font-medium mb-2">Start Date</label>
                    <input 
                      type="date" 
                      [(ngModel)]="filterOptions.dateRange.start"
                      class="w-full px-3 py-2 border border-[#cedce8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0b80ee] focus:border-transparent"
                    >
                  </div>

                  <div>
                    <label class="block text-[#49749c] text-sm font-medium mb-2">End Date</label>
                    <input 
                      type="date" 
                      [(ngModel)]="filterOptions.dateRange.end"
                      class="w-full px-3 py-2 border border-[#cedce8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0b80ee] focus:border-transparent"
                    >
                  </div>

                  <!-- Apply Filters Button -->
                  <div class="flex items-end">
                    <button 
                      (click)="applyFilters()"
                      class="w-full px-4 py-2 bg-[#0b80ee] text-white rounded-lg hover:bg-[#0966c0] transition-colors font-medium"
                    >
                      Apply Filters
                    </button>
                  </div>
                </div>

                <!-- Active Filters Display -->
                <div *ngIf="hasActiveFilters" class="mt-4 pt-4 border-t border-[#e7edf4]">
                  <h5 class="text-[#49749c] text-sm font-medium mb-2">Active Filters:</h5>
                  <div class="flex flex-wrap gap-2">
                    <span *ngIf="filterOptions.year" class="px-2 py-1 bg-[#e7edf4] text-[#0d151c] rounded text-sm">
                      Year: {{ filterOptions.year }}
                    </span>
                    <span *ngIf="filterOptions.month" class="px-2 py-1 bg-[#e7edf4] text-[#0d151c] rounded text-sm">
                      Month: {{ filterOptions.month }}
                    </span>
                    <span *ngIf="filterOptions.status" class="px-2 py-1 bg-[#e7edf4] text-[#0d151c] rounded text-sm">
                      Status: {{ filterOptions.status }}
                    </span>
                    <span *ngIf="filterOptions.minAmount" class="px-2 py-1 bg-[#e7edf4] text-[#0d151c] rounded text-sm">
                      Min: ${{ filterOptions.minAmount.toLocaleString() }}
                    </span>
                    <span *ngIf="filterOptions.maxAmount" class="px-2 py-1 bg-[#e7edf4] text-[#0d151c] rounded text-sm">
                      Max: ${{ filterOptions.maxAmount.toLocaleString() }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Results Summary -->
              <div class="mb-4 p-3 bg-[#f8f9fa] rounded-lg">
                <div class="flex justify-between items-center">
                  <span class="text-[#49749c] text-sm">
                    Showing {{ filteredPayslips.length }} of {{ payslipHistory.length }} payslips
                  </span>
                  <span *ngIf="hasActiveFilters" class="text-[#0b80ee] text-sm font-medium">
                    Filtered Results
                  </span>
                </div>
              </div>

              <div class="overflow-x-auto">
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4">
                  <div *ngFor="let payslip of displayedPayslips" class="flex justify-between items-center p-4 rounded-lg border border-[#cedce8] bg-white hover:shadow-md transition-shadow">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 bg-[#e7edf4] rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5 text-[#49749c]" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z"/>
                        </svg>
                      </div>
                      <div>
                        <div class="flex items-center gap-2">
                          <p class="text-[#0d151c] font-medium">{{ payslip.month }} {{ payslip.year }}</p>
                          <span class="px-2 py-1 rounded-full text-xs font-medium" [class]="getStatusColor(payslip.status)">
                            {{ payslip.status | titlecase }}
                          </span>
                        </div>
                        <p class="text-[#49749c] text-sm">Net Pay: ${{ payslip.netPay.toLocaleString() }}</p>
                        <p class="text-[#49749c] text-xs">Paid: {{ payslip.payDate | date:'MMM dd, yyyy' }}</p>
                      </div>
                    </div>
                    <div class="flex gap-2">
                      <button 
                        (click)="viewPayslip(payslip)"
                        class="w-8 h-8 flex items-center justify-center bg-[#e7edf4] text-[#0d151c] rounded-full hover:bg-[#d1d9e6] transition-colors"
                        title="View Details"
                      >
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                          <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                        </svg>
                      </button>
                      <button 
                        (click)="downloadAsPDF(payslip)"
                        class="w-8 h-8 flex items-center justify-center bg-[#0b80ee] text-white rounded-full hover:bg-[#0966c0] transition-colors"
                        title="Download PDF"
                      >
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"/>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Previous Payslips Download Section -->
            <div *ngIf="previousPayslips.length > 0">
              <h3 class="text-[#0d151c] text-lg font-bold mb-4">Previous Payslips</h3>
              <div class="rounded-lg border border-[#cedce8] p-4 bg-white">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  <div *ngFor="let payslip of previousPayslips" class="flex justify-between items-center p-3 hover:bg-[#f8f9fa] rounded border border-[#e7edf4]">
                    <div class="flex items-center gap-2">
                      <div class="w-6 h-6 bg-[#e7edf4] rounded-full flex items-center justify-center">
                        <svg class="w-3 h-3 text-[#49749c]" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z"/>
                        </svg>
                      </div>
                      <div>
                        <span class="text-[#49749c] text-sm">{{ payslip.month }} {{ payslip.year }}</span>
                        <div class="flex items-center gap-1">
                          <span class="px-1 py-0.5 rounded text-xs font-medium" [class]="getStatusColor(payslip.status)">
                            {{ payslip.status | titlecase }}
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="flex gap-1">
                      <button 
                        (click)="viewPayslip(payslip)"
                        class="w-6 h-6 flex items-center justify-center text-[#0b80ee] hover:text-[#0966c0] transition-colors"
                        title="View Details"
                      >
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                          <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                        </svg>
                      </button>
                      <button 
                        (click)="downloadAsPDF(payslip)"
                        class="w-6 h-6 flex items-center justify-center text-[#0b80ee] hover:text-[#0966c0] transition-colors"
                        title="Download PDF"
                      >
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"/>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- View Details Modal -->
  <div *ngIf="showDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4" style="top: 0; left: 0; right: 0; bottom: 0;">
    <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto relative" style="margin-top: 60px;">
      <!-- Modal Header -->
      <div class="flex justify-between items-center p-6 border-b border-[#cedce8] sticky top-0 bg-white z-10">
        <h3 class="text-[#0d151c] text-xl font-bold">
          Payslip Details - {{ selectedPayslip?.month }} {{ selectedPayslip?.year }}
        </h3>
        <button 
          (click)="closeDetailsModal()"
          class="text-[#49749c] hover:text-[#0d151c] transition-colors"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="p-6" *ngIf="selectedPayslip">
        <!-- Summary Section -->
        <div class="mb-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div class="text-center p-4 bg-[#f8f9fa] rounded-lg">
              <p class="text-[#49749c] text-sm font-medium">Gross Pay</p>
              <p class="text-[#0d151c] text-2xl font-bold">${{ selectedPayslip.grossPay.toLocaleString() }}</p>
            </div>
            <div class="text-center p-4 bg-[#f8f9fa] rounded-lg">
              <p class="text-[#49749c] text-sm font-medium">Deductions</p>
              <p class="text-[#0d151c] text-2xl font-bold">${{ (selectedPayslip.deductions.tax + selectedPayslip.deductions.insurance + selectedPayslip.deductions.retirement + selectedPayslip.deductions.other).toLocaleString() }}</p>
            </div>
            <div class="text-center p-4 bg-[#f8f9fa] rounded-lg">
              <p class="text-[#49749c] text-sm font-medium">Net Pay</p>
              <p class="text-[#0d151c] text-2xl font-bold">${{ selectedPayslip.netPay.toLocaleString() }}</p>
            </div>
          </div>
        </div>

        <!-- Detailed Breakdown -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Earnings -->
          <div class="border border-[#cedce8] rounded-lg p-4">
            <h4 class="text-[#0d151c] font-semibold mb-4 text-lg">Earnings Breakdown</h4>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-[#49749c]">Basic Salary</span>
                <span class="text-[#0d151c] font-medium">${{ selectedPayslip.earnings.basicSalary.toLocaleString() }}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-[#49749c]">Overtime</span>
                <span class="text-[#0d151c] font-medium">${{ selectedPayslip.earnings.overtime.toLocaleString() }}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-[#49749c]">Bonus</span>
                <span class="text-[#0d151c] font-medium">${{ selectedPayslip.earnings.bonus.toLocaleString() }}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-[#49749c]">Allowance</span>
                <span class="text-[#0d151c] font-medium">${{ selectedPayslip.earnings.allowance.toLocaleString() }}</span>
              </div>
              <div class="border-t border-[#cedce8] pt-3">
                <div class="flex justify-between items-center font-semibold">
                  <span class="text-[#0d151c]">Total Earnings</span>
                  <span class="text-[#0d151c]">${{ selectedPayslip.grossPay.toLocaleString() }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Deductions -->
          <div class="border border-[#cedce8] rounded-lg p-4">
            <h4 class="text-[#0d151c] font-semibold mb-4 text-lg">Deductions Breakdown</h4>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-[#49749c]">Tax</span>
                <span class="text-[#0d151c] font-medium">${{ selectedPayslip.deductions.tax.toLocaleString() }}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-[#49749c]">Insurance</span>
                <span class="text-[#0d151c] font-medium">${{ selectedPayslip.deductions.insurance.toLocaleString() }}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-[#49749c]">Retirement</span>
                <span class="text-[#0d151c] font-medium">${{ selectedPayslip.deductions.retirement.toLocaleString() }}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-[#49749c]">Other</span>
                <span class="text-[#0d151c] font-medium">${{ selectedPayslip.deductions.other.toLocaleString() }}</span>
              </div>
              <div class="border-t border-[#cedce8] pt-3">
                <div class="flex justify-between items-center font-semibold">
                  <span class="text-[#0d151c]">Total Deductions</span>
                  <span class="text-[#0d151c]">${{ (selectedPayslip.deductions.tax + selectedPayslip.deductions.insurance + selectedPayslip.deductions.retirement + selectedPayslip.deductions.other).toLocaleString() }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Download Options -->
        <div class="mt-6 p-4 bg-[#f8f9fa] rounded-lg">
          <h4 class="text-[#0d151c] font-semibold mb-3">Download Options</h4>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <button 
              (click)="downloadAsPDF(getSelectedPayslipHistory())"
              class="flex items-center justify-center gap-2 py-2 px-4 bg-[#0b80ee] text-white rounded-lg hover:bg-[#0966c0] transition-colors"
            >
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"/>
              </svg>
              Download PDF
            </button>
            <button 
              (click)="viewInBrowser(getSelectedPayslipHistory())"
              class="flex items-center justify-center gap-2 py-2 px-4 bg-[#e7edf4] text-[#0d151c] rounded-lg hover:bg-[#d1d9e6] transition-colors"
            >
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
              </svg>
              View in Browser
            </button>
            <button 
              (click)="printPayslip(getSelectedPayslipHistory())"
              class="flex items-center justify-center gap-2 py-2 px-4 bg-[#e7edf4] text-[#0d151c] rounded-lg hover:bg-[#d1d9e6] transition-colors"
            >
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd"/>
              </svg>
              Print
            </button>
          </div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="flex justify-end gap-3 p-6 border-t border-[#cedce8] sticky bottom-0 bg-white">
        <button 
          (click)="closeDetailsModal()"
          class="px-4 py-2 text-[#49749c] hover:text-[#0d151c] transition-colors"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>
