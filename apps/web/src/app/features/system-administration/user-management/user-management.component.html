<div class="user-management-container">
  <div class="header-section">
    <div class="title-actions">
      <h1 class="page-title">Users</h1>
      <button class="btn-new-user" (click)="onNewUser()">
        <svg fill="none" height="18px" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg">
          <path d="M5 12h14"></path>
          <path d="M12 5v14"></path>
        </svg>
        <span>New User</span>
      </button>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    <svg fill="currentColor" height="20px" viewBox="0 0 24 24" width="20px" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
    </svg>
    {{ error }}
  </div>

  <!-- Search and Filters Section -->
  <div class="search-filters-section">
    <div class="search-section">
      <label class="search-container">
        <div class="search-icon">
          <svg fill="currentColor" height="20px" viewBox="0 0 256 256" width="20px" xmlns="http://www.w3.org/2000/svg">
            <path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
          </svg>
        </div>
        <input 
          class="search-input" 
          placeholder="Search users by name or email" 
          [value]="searchTerm"
          (input)="onSearch($event)"
        />
      </label>
    </div>

    <div class="filters-section">
      <div class="filter-group">
        <label for="status-filter" class="filter-label">Status:</label>
        <select 
          id="status-filter" 
          class="filter-select" 
          [value]="statusFilter"
          (change)="onStatusFilterChange($event)"
        >
          <option value="">All Statuses</option>
          <option *ngFor="let status of availableStatuses" [value]="status">{{ status }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="role-filter" class="filter-label">Role:</label>
        <select 
          id="role-filter" 
          class="filter-select" 
          [value]="roleFilter"
          (change)="onRoleFilterChange($event)"
        >
          <option value="">All Roles</option>
          <option *ngFor="let role of availableRoles" [value]="role">{{ role }}</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading users...</p>
  </div>

  <!-- Table Container -->
  <div *ngIf="!loading" class="table-container">
    <div class="table-wrapper">
      <table class="users-table">
        <thead>
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">Role</th>
            <th scope="col">Status</th>
            <th scope="col">Created</th>
            <th scope="col" class="actions-header">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="users.length === 0" class="no-data-row">
            <td colspan="6" class="no-data-cell">
              <div class="no-data-content">
                <svg fill="currentColor" height="48px" viewBox="0 0 24 24" width="48px" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                <p>No users found</p>
              </div>
            </td>
          </tr>
          <tr *ngFor="let user of users; trackBy: trackByUserId">
            <td class="user-name">
              <div class="user-info">
                <div class="user-avatar">
                  <span>{{ user.name.charAt(0).toUpperCase() }}</span>
                </div>
                <div class="user-details">
                  <span class="user-display-name">{{ user.name }}</span>
                  <span class="user-username">&#64;{{ user.username }}</span>
                </div>
              </div>
            </td>
            <td class="user-email">{{ user.email }}</td>
            <td class="user-role">
              <span class="role-badge role-{{ user.role.toLowerCase() }}">{{ user.role }}</span>
            </td>
            <td class="user-status">
              <span 
                class="status-badge" 
                [ngClass]="{
                  'status-active': user.status === 'Active',
                  'status-inactive': user.status === 'Inactive'
                }"
              >
                {{ user.status }}
              </span>
            </td>
            <td class="user-created">{{ user.lastLogin }}</td>
            <td class="user-actions">
              <div class="action-buttons">
                <button 
                  class="action-btn view-btn" 
                  (click)="onViewUser(user)"
                  title="View User"
                >
                  <svg fill="none" height="16px" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="16px" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
                <button 
                  class="action-btn edit-btn" 
                  (click)="onEditUser(user)"
                  title="Edit User"
                >
                  <svg fill="none" height="16px" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="16px" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
                <button 
                  class="action-btn toggle-btn" 
                  [ngClass]="{
                    'toggle-active': user.status === 'Active',
                    'toggle-inactive': user.status === 'Inactive'
                  }"
                  (click)="onToggleStatus(user)"
                  [title]="user.status === 'Active' ? 'Deactivate User' : 'Activate User'"
                >
                  <svg *ngIf="user.status === 'Active'" fill="none" height="16px" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="16px" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18"></path>
                    <path d="M6 6l12 12"></path>
                  </svg>
                  <svg *ngIf="user.status === 'Inactive'" fill="none" height="16px" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="16px" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 12l2 2 4-4"></path>
                    <path d="M21 12c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1z"></path>
                    <path d="M3 12c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1z"></path>
                    <path d="M12 3c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1z"></path>
                    <path d="M12 21c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1z"></path>
                  </svg>
                </button>
                <button 
                  class="action-btn delete-btn" 
                  (click)="onDeleteUser(user)"
                  title="Delete User"
                >
                  <svg fill="none" height="16px" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="16px" xmlns="http://www.w3.org/2000/svg">
                    <polyline points="3,6 5,6 21,6"></polyline>
                    <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!loading && totalPages > 1" class="pagination-container">
    <div class="pagination-info">
      <span>Showing {{ (currentPage - 1) * pageSize + 1 }} to {{ getMathMin(currentPage * pageSize, totalUsers) }} of {{ totalUsers }} users</span>
    </div>
    <div class="pagination-controls">
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === 1"
        (click)="onPageChange(currentPage - 1)"
      >
        Previous
      </button>
      
      <div class="page-numbers">
        <button 
          *ngFor="let page of getPageNumbers()" 
          class="pagination-btn page-number"
          [class.active]="page === currentPage"
          (click)="onPageChange(page)"
        >
          {{ page }}
        </button>
      </div>
      
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === totalPages"
        (click)="onPageChange(currentPage + 1)"
      >
        Next
      </button>
    </div>
  </div>

  <!-- User Form Modal -->
  <app-user-form-modal
    [isOpen]="showUserModal"
    [user]="selectedUser"
    [isEdit]="isEditMode"
    (close)="onCloseModal()"
    (userSaved)="onUserSaved($event)"
  ></app-user-form-modal>
</div> 